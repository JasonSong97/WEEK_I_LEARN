# ğŸ“Relationships

## one to one

![alt text](image/image-18.png)

![alt text](image/image-17.png)

## one to many

![alt text](image/image-19.png)

## many to many

ì¤‘ê°„ í…Œì´ë¸” ìƒì„±ì´ í•„ìš”

![alt text](image/image-20.png)

![alt text](image/image-21.png)

### meaningful transformation

ì¤‘ê°„í…Œì´ë¸”ì„ ê·¸ëƒ¥ ì‘ì„±í•˜ì§€ ë§ê³ , ì˜ë¯¸ê°€ ìˆëŠ” ì´ë¦„ìœ¼ë¡œ ë³€ê²½í•˜ì.

![alt text](image/image-22.png)

# ğŸ“Join

sample data

```sql
CREATE SCHEMA `new_schema` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

CREATE TABLE `new_schema`.`users` (
  `id` INT NOT NULL AUTO_INCREMENT COMMENT 'This is the primary index',
  `name` VARCHAR(45) NOT NULL DEFAULT 'N/A',
  `age` INT NULL,
  PRIMARY KEY (`id`)
);

INSERT INTO `new_schema`.`users` (`id`, `name`, `age`) VALUES 
  (1, 'John', 40),
  (2, 'May', 30),
  (3, 'Tim', 25);
  
  
CREATE TABLE `new_schema`.`orders` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `user_id` INT,
  `note` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`id`)
);
 
INSERT INTO `new_schema`.`orders` (`id`, `user_id`, `note`) VALUES 
  (1, 1, 'some info'), 
  (2, 2, 'some comments'),
  (3, 2, 'no comments'),
  (4, NULL, 'weird');
```

![alt text](image/image-24.png)

## left join

ì™¼ìª½ í…Œì´ë¸”(ë“œë¼ì´ë¹™ í…Œì´ë¸”)ì—ë‹¤ê°€ ì˜¤ë¥¸ìª½ í…Œì´ë¸”(ë“œë¦¬ë¸ í…Œì´ë¸”)ì„ ë¶™ì´ëŠ” ê²ƒ. ì—¬ê¸°ì„œ ì™¼ìª½ì€ from ë’¤ì— ì˜¤ëŠ” í…Œì´ë¸”ì„ ì˜ë¯¸í•œë‹¤.

```sql
SELECT * FROM `new_schema`.`users`
LEFT JOIN `new_schema`.`orders` ON `users`.`id` = `orders`.`user_id`;
```

- users: ë“œë¼ì´ë¹™ í…Œì´ë¸”, ì™¼ìª½, ë©”ì¸ í…Œì´ë¸”
- orders: ë“œë¦¬ë¸ í…Œì´ë¸”, ì˜¤ë¥¸ìª½, ë©”ì¸ í…Œì´ë¸” ì˜¤ë¥¸ìª½ì— ë¶™ëŠ” í…Œì´ë¸”

![alt text](image/image-23.png)

ì™¼ìª½í…Œì´ë¸” usersë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¥¸ìª½ì—ë‹¤ê°€ ordersí…Œì´ë¸”ì„ ë¶™ì¸ë‹¤.

## right join

ë©”ì¸í…Œì´ë¸”(orders)ì—ë‹¤ê°€ ì™¼ìª½ í…Œì´ë¸”(users)ë¥¼ ë¶™ì¸ë‹¤.

```sql
SELECT * FROM `new_schema`.`users`
RIGHT JOIN `new_schema`.`orders` ON `users`.`id` = `orders`.`user_id`;
```

![alt text](image/image-25.png)

left joinê³¼ right joinì€ ì„œë¡œ ë°˜ëŒ€ì´ê¸° ë•Œë¬¸ì—, ì§€ê¸ˆ sqlì„ left joinìœ¼ë¡œ ë°”ê¾¸ë©´ ë™ì¼í•œ ì˜ë¯¸ê°€ ëœë‹¤.

```sql
SELECT * FROM `new_schema`.`orders`
LEFT JOIN `new_schema`.`users` ON `users`.`id` = `orders`.`user_id`;
```

## inner join

![alt text](image/image-26.png)

```sql
SELECT * FROM `new_schema`.`users`
INNER JOIN `new_schema`.`orders` ON `users`.`id` = `orders`.`user_id`;
```

![alt text](image/image-27.png)

## full outer join

![alt text](image/image-28.png)

[oracle full outer join](https://www.oracletutorial.com/oracle-basics/oracle-full-outer-join/)

```sql
SELECT
    select_list
FROM
    T1
FULL OUTER JOIN T2 ON join_condition;
```

# ğŸ“Subquries

sample data

```sql
CREATE SCHEMA `new_schema` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

CREATE TABLE `new_schema`.`users` (
  `id` INT NOT NULL AUTO_INCREMENT COMMENT 'This is the primary index',
  `name` VARCHAR(45) NOT NULL DEFAULT 'N/A',
  `age` INT NULL,
  PRIMARY KEY (`id`)
);

INSERT INTO `new_schema`.`users` (`id`, `name`, `age`) VALUES 
  (1, 'John', 40),
  (2, 'May', 30),
  (3, 'Tim', 22);
  
  
CREATE TABLE `new_schema`.`orders` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `user_id` INT,
  `note` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`id`)
);
 
INSERT INTO `new_schema`.`orders` (`id`, `user_id`, `note`) VALUES 
  (1, 1, 'some information'), 
  (2, 2, 'some comments'),
  (3, 2, 'no comments'),
  (4, 3, 'more comments');
```

## equal condition

```sql
SELECT * FROM `new_schema`.`orders`
WHERE user_id = (
  SELECT id FROM `new_schema`.`users`
  WHERE name = 'John'
);

-- ì„œë¸Œì¿¼ë¦¬: 1ê°œë§Œ ë¦¬í„´
SELECT id FROM `new_schema`.`users` WHERE name = 'John';
```

## contain condition

```sql
SELECT * FROM `new_schema`.`orders`
WHERE user_id IN (
  SELECT id FROM `new_schema`.`users`
  WHERE name LIKE '%j%'
);

-- ì„œë¸Œì¿¼ë¦¬: ì—¬ëŸ¬ê°œë¥¼ ë¦¬í„´
SELECT id FROM `new_schema`.`users` WHERE name LIKE '%j%';
```

## common mistake

### singluar and plural problem

```sql
SELECT * FROM `new_schema`.`orders`
WHERE user_id = (
  SELECT id FROM `new_schema`.`users`
  WHERE name LIKE '%j%'
);
```

likeì˜ ê²½ìš° ì—¬ëŸ¬ê°œì˜ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ì˜¤ë¥˜ê°€ ë‚œë‹¤. `=`ê°€ ì•„ë‹Œ `in`ìœ¼ë¡œ ë°”ê¿”ì£¼ì. 

```sql
SELECT * FROM `new_schema`.`orders`
WHERE user_id IN (
  SELECT id FROM `new_schema`.`users`
  WHERE name LIKE '%j%'
);

```

### redundant columns in subqueries

`*`ì˜ ê²½ìš°ëŠ” ì‚¬ìš©í•˜ì§€ ë§ì. í•„ìš”í•œ ì¿¼ë¦¬ê°€ ì•„ë‹Œ ëª¨ë“  ì¿¼ë¦¬ë¥¼ ê°€ì§€ê³  ì˜¤ë©´ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

```sql
SELECT * FROM `new_schema`.`orders`
WHERE user_id IN (
  SELECT * FROM `new_schema`.`users`
  WHERE name LIKE '%j%'
);
```